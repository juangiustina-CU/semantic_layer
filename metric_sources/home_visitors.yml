---
name: Home Visitors
description: "Migrated from Eppo fact: Home Visitors"
tags:
  - Eppo
  - Migrated
  - Semantic Layer
sql: |
  with ios_visitors as (
  select 
  cus.customer_id,
  delivery_date,
  visited_ts,
  count(*) as ios_visitors_events
  from cu_dbt_prod.bronze_segment.sdui_service_screens ios
  left join CU_DBT_PROD.ENTITIES_DIM.DIM_CUSTOMERS cus on ios.magento_customer_id=cus.magento_customer_id
  group by all
  
  union all
  
  select 
  cus.customer_id,
  delivery_date,
  sent_ts as visited_ts,
  count(*) as ios_visitors_events
  from cu_dbt_prod.bronze_segment.ios_screens ios
  left join CU_DBT_PROD.ENTITIES_DIM.DIM_CUSTOMERS cus on ios.user_id=cus.magento_customer_id
  group by all
  )
  select
          --date_trunc(week, delivery_date) as delivery_week,
          delivery_date,
          --(date_trunc(day, visited_ts) + interval '1 day' - interval '1 second') :: timestamp as visited_date,
          customer_id,
          max(ios_visitors_events) as max_ios_visitors_events
  from 
      ios_visitors
  where date_trunc(week, delivery_date) <= date_trunc(week, current_date)
  group by all
timestampColumn: DELIVERY_DATE
timestampAsDay: true
idTypeMapping:
  - statsigUnitID: userID
    column: CUSTOMER_ID